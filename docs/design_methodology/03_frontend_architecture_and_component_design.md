# 3. 前端架构与组件化设计

本文档聚焦于前端应用的架构、核心工作流程、组件化策略以及与后端 API 的交互模式。

## 3.1. 前端技术栈与理念

我们选择了一套轻量级、高效的技术栈，旨在快速构建功能强大且易于维护的管理界面。

-   **核心语言**: **原生 JavaScript (ES6+)**。我们充分利用现代浏览器的原生能力，避免不必要的框架抽象，以获得最佳性能和最快的加载速度。
-   **响应式框架**: **Alpine.js**。它被称为“轻量级的 Vue”或“Tailwind 的 JavaScript 伴侣”。Alpine.js 让我们可以在 HTML 中直接声明组件的行为和状态，极大地简化了 DOM 操作和状态管理，同时保持了代码的简洁和就近原则（colocation of concerns）。
-   **CSS 框架**: **Tailwind CSS**。通过原子化/功能优先的 CSS 类，我们可以快速构建任何设计，而无需编写自定义 CSS。这保证了整个应用 UI 的一致性，并显著提升了开发效率。
-   **图标库**: **Lucide Icons**。提供了一套美观、一致且轻量级的 SVG 图标。

**核心理念**: **渐进式增强 (Progressive Enhancement)**。应用的核心是一个标准的 HTML 文件 (`index.html`)，JavaScript 在其之上提供动态和交互功能。这种方式确保了即使在 JS 加载失败或被禁用的极端情况下，基础的页面结构依然可见。

## 3.2. 核心文件与应用入口

-   **`frontend/index.html`**: 单页应用（SPA）的唯一入口。它包含了应用的整体布局骨架（导航栏、主内容区、页脚）、所有 CSS 和 JS 文件的引用，以及 Alpine.js 组件的根定义。
-   **`frontend/src/app.js`**: 前端应用的核心控制器。它以一个 `App` 类的形式存在，负责整个应用的生命周期管理，包括：
    -   **初始化 (`init`)**: 应用启动的入口点，负责加载配置、检查 API 连接、初始化所有视图组件、设置路由等。
    -   **路由管理 (`setupRouting`, `loadView`)**: 监听 URL 变化和导航链接点击，动态加载和渲染不同的视图（如仪表盘、任务、日志等）。
    -   **状态管理**: 维护全局应用状态，如当前视图、API 连接状态等。
    -   **全局事件监听**: 设置全局的事件处理器，如网络状态变化、键盘快捷键等。

## 3.3. 视图与组件化设计

我们将前端界面划分为多个独立的“视图”（View），每个视图对应一个主要的功能模块。每个视图由一个专门的 JavaScript 组件文件来驱动。

-   **位置**: `frontend/src/components/*.js` (例如: `dashboard.js`, `tasks.js`, `logs.js`)

-   **组件结构**: 每个组件文件都遵循一个标准模式，导出一个对象，该对象至少包含以下方法：
    -   `init()`: 组件的初始化函数。在应用启动时由 `app.js` 调用，通常用于设置初始状态或加载静态数据。
    -   `render()`: 视图渲染函数。在视图被加载到 DOM 后由 `app.js` 调用。此函数负责执行该视图特有的逻辑，例如获取数据、初始化图表、绑定事件监听器等。
    -   **其他辅助函数**: 组件内部使用的私有或公有方法。

-   **工作流程**: 当用户导航到一个新视图时（例如，从“仪表盘”点击到“日志管理”）：
    1.  `app.js` 的路由系统捕获到导航事件。
    2.  调用 `loadView('logs')` 方法。
    3.  `loadView` 首先从 `index.html` 内联的 `<template>` 标签中获取“日志”视图的 HTML 模板。
    4.  将模板内容插入到主内容区域 (`#main-content`)。
    5.  调用 `logs.js` 中导出的 `render()` 方法。
    6.  `logs.js` 的 `render()` 方法开始执行，向后端 API (`/api/logs/system`) 发送请求以获取日志数据。
    7.  获取数据后，`logs.js` 动态地将数据渲染到 HTML 表格中，并初始化分页、筛选等交互功能。

## 3.4. 与后端 API 的交互

前端与后端的通信完全通过异步的 HTTP/S API 调用实现。

-   **API 服务层**: 我们在 `frontend/src/services/api.js` 中封装了所有与后端 API 的交互逻辑。这个模块提供了一组简单易用的函数，如 `api.get(endpoint)`, `api.post(endpoint, data)` 等。
-   **好处**:
    1.  **代码复用**: 所有组件都通过 `api.js` 进行通信，避免了在多个地方重复编写 `fetch` 调用。
    2.  **集中管理**: 错误处理、请求头设置（如 `Authorization`）、URL 前缀等都可以在 `api.js` 中统一处理。
    3.  **解耦**: 组件本身不关心 `fetch` 的具体实现细节，只关心调用哪个服务函数和处理返回的数据。

-   **数据流示例 (获取系统日志)**:
    1.  `logs.js` 的 `fetchSystemLogs()` 方法被调用。
    2.  该方法调用 `api.get('/logs/system?page=1&limit=20')`。
    3.  `api.js` 中的 `get` 函数执行 `fetch` 请求，并处理 Promise。
    4.  请求成功后，`api.js` 返回解析后的 JSON 数据。
    5.  `logs.js` 在 `.then()` 块中接收到数据，并将其更新到 Alpine.js 的组件状态中，从而自动触发 UI 的重新渲染。

## 3.5. 总结

前端架构采用了一种务实、轻量级的方法。通过将原生 JavaScript、Alpine.js 和 Tailwind CSS 相结合，我们构建了一个既现代又高效的开发工作流。清晰的 `App` 控制器、模块化的视图组件以及集中的 API 服务层，共同构成了一个结构清晰、易于理解和扩展的前端应用。这种架构在满足当前所有功能需求的同时，也为未来的快速迭代打下了坚实的基础。