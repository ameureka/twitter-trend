# ğŸ“¦ Appæ¨¡å—è®°å¿† (App Module Memory)

## æ¨¡å—æ¦‚è¿°
è¿™æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒåº”ç”¨æ¨¡å—ï¼ŒåŒ…å«æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“æ“ä½œå’Œå·¥å…·å‡½æ•°ã€‚

## ğŸ—ï¸ æ¨¡å—ç»“æ„

### core/ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
```
content_generator.py
â”œâ”€â”€ ContentGeneratorç±»
â”‚   â”œâ”€â”€ generate_tweet_content() - AIç”Ÿæˆæ¨æ–‡å†…å®¹
â”‚   â”œâ”€â”€ _call_gemini_api() - è°ƒç”¨Google Gemini API
â”‚   â””â”€â”€ _format_content() - æ ¼å¼åŒ–ç”Ÿæˆå†…å®¹
â”‚
enhanced_scheduler.py  
â”œâ”€â”€ EnhancedTaskSchedulerç±» [âš ï¸ é‡ç‚¹å…³æ³¨]
â”‚   â”œâ”€â”€ start() - å¯åŠ¨è°ƒåº¦å™¨
â”‚   â”œâ”€â”€ _process_pending_tasks() - å¤„ç†å¾…æ‰§è¡Œä»»åŠ¡
â”‚   â”œâ”€â”€ _execute_task() - æ‰§è¡Œå•ä¸ªä»»åŠ¡
â”‚   â””â”€â”€ _handle_task_failure() - ä»»åŠ¡å¤±è´¥å¤„ç†
â”‚
publisher.py
â”œâ”€â”€ TwitterPublisherç±»
â”‚   â”œâ”€â”€ publish_media_with_text() - å‘å¸ƒå¸¦åª’ä½“çš„æ¨æ–‡
â”‚   â”œâ”€â”€ _upload_media() - ä¸Šä¼ åª’ä½“æ–‡ä»¶
â”‚   â””â”€â”€ _post_tweet() - å‘é€æ¨æ–‡
â”‚
task_scheduler.py [âš ï¸ é—ç•™ä»£ç ]
â””â”€â”€ æ—§ç‰ˆè°ƒåº¦å™¨ï¼Œä¸enhanced_scheduleråŠŸèƒ½é‡å¤
```

### database/ - æ•°æ®è®¿é—®å±‚
```
models.py
â”œâ”€â”€ User - ç”¨æˆ·æ¨¡å‹
â”œâ”€â”€ ApiKey - APIå¯†é’¥æ¨¡å‹
â”œâ”€â”€ Project - é¡¹ç›®æ¨¡å‹ [æ ¸å¿ƒ]
â”œâ”€â”€ ContentSource - å†…å®¹æºæ¨¡å‹
â”œâ”€â”€ PublishingTask - å‘å¸ƒä»»åŠ¡æ¨¡å‹ [æ ¸å¿ƒ]
â”œâ”€â”€ PublishingLog - å‘å¸ƒæ—¥å¿—æ¨¡å‹
â””â”€â”€ AnalyticsHourly - å°æ—¶ç»Ÿè®¡æ¨¡å‹

db_manager.py
â”œâ”€â”€ EnhancedDatabaseManagerç±»
â”‚   â”œâ”€â”€ initialize_database() - åˆå§‹åŒ–æ•°æ®åº“
â”‚   â”œâ”€â”€ create_task() - åˆ›å»ºä»»åŠ¡
â”‚   â”œâ”€â”€ get_pending_tasks() - è·å–å¾…å¤„ç†ä»»åŠ¡
â”‚   â””â”€â”€ update_task_status() - æ›´æ–°ä»»åŠ¡çŠ¶æ€

repository.py
â””â”€â”€ æ•°æ®ä»“å‚¨æ¨¡å¼å®ç°
```

### utils/ - å·¥å…·æ¨¡å—
```
enhanced_config.py
â”œâ”€â”€ get_enhanced_config() - è·å–é…ç½®
â””â”€â”€ ConfigManagerç±» - é…ç½®ç®¡ç†å™¨

logger.py
â”œâ”€â”€ setup_logger() - è®¾ç½®æ—¥å¿—
â””â”€â”€ get_logger() - è·å–æ—¥å¿—å™¨

path_manager.py [âš ï¸ é—®é¢˜æº]
â”œâ”€â”€ è·¯å¾„ç¡¬ç¼–ç é—®é¢˜é›†ä¸­åœ°
â””â”€â”€ éœ€è¦é‡æ„ä¸ºåŠ¨æ€è·¯å¾„

error_handler.py
â”œâ”€â”€ ErrorHandlerç±»
â””â”€â”€ å…¨å±€å¼‚å¸¸å¤„ç†

performance_monitor.py
â”œâ”€â”€ PerformanceMonitorç±»
â””â”€â”€ ç³»ç»Ÿæ€§èƒ½ç›‘æ§
```

## ğŸ”´ å…³é”®é—®é¢˜å®šä½

### 1. è·¯å¾„ç¡¬ç¼–ç é—®é¢˜
**ä½ç½®**: `utils/path_manager.py`, `utils/dynamic_path_manager.py`
```python
# é—®é¢˜ä»£ç ç¤ºä¾‹
MEDIA_PATH = "/Users/ameureka/Desktop/xxx"  # ç¡¬ç¼–ç è·¯å¾„
```
**å½±å“**: è·¨ç¯å¢ƒéƒ¨ç½²å¤±è´¥
**ä¿®å¤æ–¹æ¡ˆ**: ä½¿ç”¨ç›¸å¯¹è·¯å¾„ + é…ç½®æ–‡ä»¶

### 2. æ—¶åŒºå¤„ç†æ··ä¹±
**ä½ç½®**: `core/enhanced_scheduler.py` line 145-180
```python
# é—®é¢˜ï¼šæ··ç”¨UTCå’Œæœ¬åœ°æ—¶é—´
scheduled_time = datetime.now()  # æœ¬åœ°æ—¶é—´
task.scheduled_at  # UTCæ—¶é—´å­˜å‚¨
```
**å½±å“**: ä»»åŠ¡è°ƒåº¦æ—¶é—´é”™è¯¯
**ä¿®å¤æ–¹æ¡ˆ**: ç»Ÿä¸€ä½¿ç”¨UTCï¼Œæ˜¾ç¤ºæ—¶è½¬æ¢

### 3. æ•°æ®åº“å¹¶å‘é—®é¢˜
**ä½ç½®**: `database/db_manager.py` line 234-267
```python
# SQLiteåœ¨é«˜å¹¶å‘ä¸‹çš„é”é—®é¢˜
# SQLITE_BUSYé”™è¯¯é¢‘å‘
```
**å½±å“**: ä»»åŠ¡æ‰§è¡Œå¤±è´¥
**ä¿®å¤æ–¹æ¡ˆ**: 
- å®ç°é‡è¯•æœºåˆ¶
- ä½¿ç”¨WALæ¨¡å¼
- è€ƒè™‘è¿ç§»åˆ°PostgreSQL

### 4. å†…å­˜æ³„æ¼
**ä½ç½®**: `core/enhanced_scheduler.py`
```python
# ç–‘ä¼¼é—®é¢˜ï¼šä»»åŠ¡åˆ—è¡¨æ— é™å¢é•¿
self.processed_tasks.append(task)  # ä»ä¸æ¸…ç†
```
**å½±å“**: é•¿æ—¶é—´è¿è¡Œå†…å­˜å ç”¨å¢é•¿
**ä¿®å¤æ–¹æ¡ˆ**: å®šæœŸæ¸…ç†å†å²æ•°æ®

## ğŸ“Š æ€§èƒ½ç“¶é¢ˆ

### æ•°æ®åº“æŸ¥è¯¢
- `get_pending_tasks()` æ— ç´¢å¼•å…¨è¡¨æ‰«æ
- å»ºè®®æ·»åŠ å¤åˆç´¢å¼•ï¼š(status, scheduled_at, priority)

### æ–‡ä»¶IO
- åª’ä½“æ–‡ä»¶ä¸Šä¼ æœªä½¿ç”¨å¼‚æ­¥IO
- å¤§æ–‡ä»¶å¤„ç†é˜»å¡ä¸»çº¿ç¨‹

## ğŸ”§ é‡æ„å»ºè®®

### é«˜ä¼˜å…ˆçº§
1. **æŠ½å–é…ç½®ç®¡ç†å™¨**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®
2. **è·¯å¾„ç®¡ç†é‡æ„**: æ¶ˆé™¤æ‰€æœ‰ç¡¬ç¼–ç è·¯å¾„
3. **æ—¶åŒºå¤„ç†ç»Ÿä¸€**: å»ºç«‹æ—¶åŒºå¤„ç†å·¥å…·ç±»
4. **æ·»åŠ å•å…ƒæµ‹è¯•**: å½“å‰æµ‹è¯•è¦†ç›–ç‡<30%

### ä¸­ä¼˜å…ˆçº§
1. **åˆ†ç¦»è°ƒåº¦å™¨é€»è¾‘**: è§£è€¦è°ƒåº¦å’Œæ‰§è¡Œ
2. **å®ç°è¿æ¥æ± **: æ•°æ®åº“è¿æ¥æ± ç®¡ç†
3. **å¼‚æ­¥IOæ”¹é€ **: æ–‡ä»¶æ“ä½œå¼‚æ­¥åŒ–
4. **æ—¥å¿—ç³»ç»Ÿä¼˜åŒ–**: ç»“æ„åŒ–æ—¥å¿— + æ—¥å¿—è½®è½¬

### ä½ä¼˜å…ˆçº§
1. **ä»£ç é£æ ¼ç»Ÿä¸€**: ä½¿ç”¨Blackæ ¼å¼åŒ–
2. **ç±»å‹æ³¨è§£å®Œå–„**: æ·»åŠ ç±»å‹æç¤º
3. **æ–‡æ¡£è¡¥å……**: æ·»åŠ docstring

## ğŸ¯ å¿«é€Ÿå®šä½æŒ‡å—

### æŸ¥æ‰¾ä»»åŠ¡æ‰§è¡Œå¤±è´¥åŸå› 
1. æŸ¥çœ‹ `logs/main.log` ä¸­çš„ERRORçº§åˆ«æ—¥å¿—
2. æ£€æŸ¥ `enhanced_scheduler.py` çš„ `_handle_task_failure()` æ–¹æ³•
3. æŸ¥è¯¢æ•°æ®åº“ `publishing_logs` è¡¨çš„error_messageå­—æ®µ

### è°ƒè¯•è°ƒåº¦å™¨é—®é¢˜
1. åœ¨ `enhanced_scheduler.py` line 156 è®¾ç½®æ–­ç‚¹
2. æŸ¥çœ‹ `_process_pending_tasks()` æ–¹æ³•çš„æ‰§è¡Œæµç¨‹
3. æ£€æŸ¥ä»»åŠ¡çš„scheduled_atæ—¶é—´æ˜¯å¦æ­£ç¡®

### æ•°æ®åº“é”é—®é¢˜æ’æŸ¥
1. å¯ç”¨SQLiteæ—¥å¿—ï¼š`PRAGMA journal_mode=WAL;`
2. ç›‘æ§ `db_manager.py` çš„æ•°æ®åº“æ“ä½œè€—æ—¶
3. æ£€æŸ¥æ˜¯å¦æœ‰é•¿äº‹åŠ¡æœªæäº¤

## æ›´æ–°è®°å½•
- 2025-08-16: åˆ›å»ºappæ¨¡å—è®°å¿†æ–‡æ¡£
- é—®é¢˜æ ‡æ³¨ï¼š[âš ï¸] éœ€è¦ç«‹å³å…³æ³¨çš„é—®é¢˜
- é—®é¢˜æ ‡æ³¨ï¼š[ğŸ”´] ä¸¥é‡é—®é¢˜